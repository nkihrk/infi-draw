import { Injectable } from '@angular/core';
import { MemoryService } from './memory.service';
import { CleanupService } from '../module/cleanup.service';
import { PenService } from '../module/pen.service';
import { EraseService } from '../module/erase.service';
import { CreateSquareService } from '../module/create-square.service';
import { CreateLineService } from '../module/create-line.service';
import * as _ from 'lodash';

@Injectable({
	providedIn: 'root'
})
export class FuncService {
	constructor(
		private memory: MemoryService,
		private cleanupFunc: CleanupService,
		private penFunc: PenService,
		private eraseFunc: EraseService,
		private createSquareFunc: CreateSquareService,
		private createLineFunc: CreateLineService
	) {}

	//////////////////////////////////////////////////////////
	//
	// Save
	//
	//////////////////////////////////////////////////////////

	save(): void {}

	//////////////////////////////////////////////////////////
	//
	// Undo / redo
	//
	//////////////////////////////////////////////////////////

	undo(): void {
		this.memory.undo();
	}

	redo(): void {
		this.memory.redo();
	}

	//////////////////////////////////////////////////////////
	//
	// Unload
	//
	//////////////////////////////////////////////////////////

	unload($e: any): void {
		if (this.memory.states.isChangedStates) {
			$e.returnValue = true;
		}
	}

	//////////////////////////////////////////////////////////
	//
	// Clean up
	//
	//////////////////////////////////////////////////////////

	cleanUp(): void {
		this.cleanupFunc.activate();
	}

	//////////////////////////////////////////////////////////
	//
	// Hand
	//
	//////////////////////////////////////////////////////////

	hand(): void {
		this.memory.reservedByFunc.current = {
			name: 'hand',
			type: '',
			group: ''
		};
	}

	//////////////////////////////////////////////////////////
	//
	// Pen
	//
	//////////////////////////////////////////////////////////

	pen(): void {
		this.penFunc.activate();
	}

	//////////////////////////////////////////////////////////
	//
	// Eraser
	//
	//////////////////////////////////////////////////////////

	eraser(): void {
		this.eraseFunc.activate();
	}

	//////////////////////////////////////////////////////////
	//
	// Create square
	//
	//////////////////////////////////////////////////////////

	createSquare(): void {
		this.createSquareFunc.activate();
	}

	//////////////////////////////////////////////////////////
	//
	// Create line
	//
	//////////////////////////////////////////////////////////

	createLine(): void {
		this.createLineFunc.activate();
	}

	//////////////////////////////////////////////////////////
	//
	// Zoom
	//
	//////////////////////////////////////////////////////////

	zoom($flg: boolean): void {
		if ($flg) {
			this.memory.reservedByFunc.current = {
				name: 'zoom',
				type: '',
				group: ''
			};
		} else {
			this.memory.reservedByFunc.current = _.cloneDeep(this.memory.reservedByFunc.prev);
		}
	}
}
